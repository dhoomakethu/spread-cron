Running tests on a test flinger device
Loading environment variables
Using environment file: tf_snapd_cm3_refresh
Deleting test flinger data
Creating job for snapd using a device
Running testflinger client
Submitting job to testflinger
JOB_ID: 8aa5aeeb-101e-43a5-98dd-17133115196f
Print job: /var/snap/testflinger-cli/current/job.yaml 
job_queue: cm3
global_timeout: 36000
provision_data:
    url: http://cdimage.ubuntu.com/ubuntu-core/16/stable/current/ubuntu-core-16-cm3.img.xz
test_data:
    test_cmds: |
        #!/bin/bash
        sudo apt update || ps aux | grep apt
        sudo apt install -y git curl sshpass
        git clone https://github.com/sergiocazzolato/snappy-qa-jobs.git
        (cd snappy-qa-jobs && git checkout master)
        git clone https://git.launchpad.net/snapd-vendor snapd
        (cd snapd && git checkout master)
        . snapd/tests/lib/external/prepare-ssh.sh "{device_ip}" "22" "ubuntu"
        . snappy-qa-jobs/scripts/utils/register_device.sh "{device_ip}" "22" "test" "ubuntu" "sergiocazzolato@yahoo.com.ar"
        . snappy-qa-jobs/scripts/utils/refresh.sh "{device_ip}" "22" "test" "ubuntu" "stable" "edge"
        . snappy-qa-jobs/scripts/utils/run_setup.sh "{device_ip}" "22" "test" "ubuntu" ""
        . snappy-qa-jobs/scripts/utils/get_spread.sh
        . snappy-qa-jobs/scripts/utils/run_spread.sh "{device_ip}" "22" "snapd" "external:ubuntu-core-16-arm-32:tests/" "" "tests/main/auto-refresh,tests/main/interfaces-content" "-v"
Showing job data
This job is currently waiting on a node to become available. You will see no further output until the job starts running.
***********************************

* Starting setup phase on cm3-001 *

***********************************

Cleaning up container if it exists...
Error response from daemon: No such container: cm3001

***************************************

* Starting provision phase on cm3-001 *

***************************************
Install python-logstash if you want to use logstash logging
2018-08-21 04:30:56,603 cm3-001 INFO: BEGIN provision
2018-08-21 04:30:56,603 cm3-001 INFO: Provisioning device
2018-08-21 04:31:02,939 cm3-001 INFO: Running snmpset -c private -v1 10.101.48.8 .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 i 2
iso.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 = INTEGER: 2
2018-08-21 04:31:03,058 cm3-001 INFO: Running sleep 10
2018-08-21 04:31:13,075 cm3-001 INFO: Running snmpset -c private -v1 10.101.48.8 .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 i 1
iso.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 = INTEGER: 1
2018-08-21 04:31:13,194 cm3-001 INFO: Flashing image
2018-08-21 04:35:57,594 cm3-001 INFO: b"Warning: Permanently added '10.101.50.180' (ECDSA) to the list of known hosts.\r\ntesting...\n+ echo testing...\n+ /snap/cm3-installer/6/bin/rpiboot -d /snap/cm3-installer/6/msd\nWaiting for BCM2835/6/7\nSending bootcode.bin\nSuccessful read 4 bytes \nWaiting for BCM2835/6/7\nSecond stage boot server\nFile read: start.elf\nSecond stage boot server done\nstarting image download...\n+ echo 'starting image download...'\n+ curl -L http://cdimage.ubuntu.com/ubuntu-core/16/stable/current/ubuntu-core-16-cm3.img.xz\n+ unxz -c\n+ dd of=/dev/sda bs=4M oflag=sync\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0  334M    0 28713    0     0  21071      0  4:37:15  0:00:01  4:37:14 21066\r  0  334M    0  195k    0     0  80783      0  1:12:19  0:00:02  1:12:17 80788\r  0  334M    0  628k    0     0   174k      0  0:32:37  0:00:03  0:32:34  174k\r  0  334M    0 1050k    0     0   237k      0  0:24:02  0:00:04  0:23:58  237k\r  0  334M    0 1495k    0     0   269k      0  0:21:08  0:00:05  0:21:03  297k\r  0  334M    0 1846k    0     0   289k      0  0:19:42  0:00:06  0:19:36  362k\r  0  334M    0 2308k    0     0   314k      0  0:18:07  0:00:07  0:18:00  434k\r  0  334M    0 2663k    0     0   319k      0  0:17:50  0:00:08  0:17:42  429k\r  0  334M    0 3146k    0     0   332k      0  0:17:08  0:00:09  0:16:59  417k\r  1  334M    1 3646k    0     0   352k      0  0:16:11  0:00:10  0:16:01  447k\r  1  334M    1 4109k    0     0   360k      0  0:15:49  0:00:11  0:15:38  450k\r  1  334M    1 4808k    0     0   389k      0  0:14:39  0:00:12  0:14:27  498k\r  1  334M    1 5503k    0     0   411k      0  0:13:51  0:00:13  0:13:38  564k\r  1  334M    1 6418k    0     0   447k      0  0:12:45  0:00:14  0:12:31  668k\r  2  334M    2 7268k    0     0   474k      0  0:12:02  0:00:15  0:11:47  727k\r  2  334M    2 8150k    0     0   498k      0  0:11:26  0:00:16  0:11:10  818k\r  2  334M    2 9233k    0     0   531k      0  0:10:43  0:00:17  0:10:26  882k\r  2  334M    2  9.8M    0     0   550k      0  0:10:21  0:00:18  0:10:03  922k\r  3  334M    3 10.9M    0     0   579k      0  0:09:50  0:00:19  0:09:31  960k\r  3  334M    3 11.6M    0     0   585k      0  0:09:44  0:00:20  0:09:24  928k\r  3  334M    3 12.3M    0     0   592k      0  0:09:38  0:00:21  0:09:17  893k\r  3  334M    3 12.9M    0     0   595k      0  0:09:35  0:00:22  0:09:13  815k\r  4  334M    4 13.6M    0     0   596k      0  0:09:33  0:00:23  0:09:10  764k\r  4  334M    4 14.3M    0     0   602k      0  0:09:28  0:00:24  0:09:04  689k\r  4  334M    4 14.9M    0     0   602k      0  0:09:28  0:00:25  0:09:03  671k\r  4  334M    4 15.4M    0     0   573k      0  0:09:57  0:00:27  0:09:30  508k\r  4  334M    4 15.5M    0     0   397k      0  0:14:21  0:00:39  0:13:42  147k\r  4  334M    4 15.5M    0     0   338k      0  0:16:51  0:00:47  0:16:04 85474\r  5  334M    5 17.2M    0     0   372k      0  0:15:19  0:00:47  0:14:32  128k\r  5  334M    5 17.7M    0     0   375k      0  0:15:12  0:00:48  0:14:24  125k\r  5  334M    5 18.1M    0     0   374k      0  0:15:13  0:00:49  0:14:24  123k\r  5  334M    5 18.4M    0     0   374k      0  0:15:13  0:00:50  0:14:23  287k\r  5  334M    5 18.9M    0     0   376k      0  0:15:10  0:00:51  0:14:19  770k\r  5  334M    5 19.3M    0     0   378k      0  0:15:04  0:00:52  0:14:12  436k\r  6  334M    6 20.0M    0     0   385k      0  0:14:49  0:00:53  0:13:56  479k\r  6  334M    6 21.1M    0     0   397k      0  0:14:21  0:00:54  0:13:27  632k\r  6  334M    6 21.8M    0     0   403k      0  0:14:07  0:00:55  0:13:12  694k\r  6  334M    6 22.6M    0     0   411k      0  0:13:52  0:00:56  0:12:56  786k\r  6  334M    6 23.2M    0     0   414k      0  0:13:45  0:00:57  0:12:48  791k\r  7  334M    7 23.8M    0     0   417k      0  0:13:39  0:00:58  0:12:41  773k\r  7  334M    7 24.3M    0     0   419k      0  0:13:35  0:00:59  0:12:36  664k\r  7  334M    7 24.9M    0     0   423k      0  0:13:28  0:01:00  0:12:28  642k\r  7  334M    7 25.6M    0     0   427k      0  0:13:20  0:01:01  0:12:19  609k\r  7  334M    7 26.1M    0     0   429k      0  0:13:17  0:01:02  0:12:15  599k\r  8  334M    8 26.8M    0     0   433k      0  0:13:09  0:01:03  0:12:06  620k\r  8  334M    8 27.3M    0     0   435k      0  0:13:05  0:01:04  0:12:01  624k\r  8  334M    8 28.1M    0     0   440k      0  0:12:57  0:01:05  0:11:52  645k\r  8  334M    8 28.8M    0     0   445k      0  0:12:47  0:01:06  0:11:41  671k\r  8  334M    8 29.6M    0     0   451k      0  0:12:38  0:01:07  0:11:31  720k\r  9  334M    9 30.7M    0     0   461k      0  0:12:21  0:01:08  0:11:13  813k\r  9  334M    9 31.9M    0     0   471k      0  0:12:05  0:01:09  0:10:56  932k\r 10  334M   10 33.6M    0     0   490k      0  0:11:38  0:01:10  0:10:28 1147k\r 10  334M   10 35.6M    0     0   512k      0  0:11:08  0:01:11  0:09:57 1392k\r 11  334M   11 37.7M    0     0   533k      0  0:10:41  0:01:12  0:09:29 1646k\r 11  334M   11 39.1M    0     0   546k      0  0:10:26  0:01:13  0:09:13 1707k\r 12  334M   12 40.4M    0     0   556k      0  0:10:14  0:01:14  0:09:00 1739k\r 12  334M   12 42.0M    0     0   571k      0  0:09:59  0:01:15  0:08:44 1705k\r 12  334M   12 43.4M    0     0   582k      0  0:09:47  0:01:16  0:08:31 1590k\r 13  334M   13 45.0M    0     0   596k      0  0:09:34  0:01:17  0:08:17 1501k\r 13  334M   13 46.5M    0     0   609k      0  0:09:22  0:01:18  0:08:04 1528k\r 14  334M   14 48.0M    0     0   619k      0  0:09:12  0:01:19  0:07:53 1558k\r 14  334M   14 49.7M    0     0   633k      0  0:09:00  0:01:20  0:07:40 1577k\r 15  334M   15 51.1M    0     0   643k      0  0:08:51  0:01:21  0:07:30 1575k\r 15  334M   15 52.9M    0     0   658k      0  0:08:39  0:01:22  0:07:17 1625k\r 16  334M   16 54.7M    0     0   673k      0  0:08:28  0:01:23  0:07:05 1675k\r 16  334M   16 56.7M    0     0   689k      0  0:08:16  0:01:24  0:06:52 1780k\r 17  334M   17 59.2M    0     0   710k      0  0:08:01  0:01:25  0:06:36 1945k\r 18  334M   18 61.6M    0     0   730k      0  0:07:48  0:01:26  0:06:22 2146k\r 19  334M   19 64.3M    0     0   754k      0  0:07:33  0:01:27  0:06:06 2332k\r 19  334M   19 66.6M    0     0   772k      0  0:07:23  0:01:28  0:05:55 2429k\r 20  334M   20 68.7M    0     0   786k      0  0:07:15  0:01:29  0:05:46 2390k\r 21  334M   21 70.4M    0     0   798k      0  0:07:08  0:01:30  0:05:38 2298k\r 21  334M   21 71.8M    0     0   805k      0  0:07:05  0:01:31  0:05:34 2085k\r 21  334M   21 73.4M    0     0   814k      0  0:07:00  0:01:32  0:05:28 1869k\r 22  334M   22 74.9M    0     0   822k      0  0:06:56  0:01:33  0:05:23 1700k\r 22  334M   22 76.6M    0     0   831k      0  0:06:51  0:01:34  0:05:17 1666k\r 23  334M   23 78.2M    0     0   840k      0  0:06:47  0:01:35  0:05:12 1602k\r 23  334M   23 79.7M    0     0   845k      0  0:06:44  0:01:36  0:05:08 1554k\r 24  334M   24 80.9M    0     0   851k      0  0:06:42  0:01:37  0:05:05 1523k\r 24  334M   24 81.7M    0     0   851k      0  0:06:41  0:01:38  0:05:03 1399k\r 24  334M   24 82.8M    0     0   853k      0  0:06:41  0:01:39  0:05:02 1261k\r 25  334M   25 83.7M    0     0   855k      0  0:06:40  0:01:40  0:05:00 1131k\r 25  334M   25 84.8M    0     0   856k      0  0:06:39  0:01:41  0:04:58 1083k\r 25  334M   25 85.8M    0     0   859k      0  0:06:38  0:01:42  0:04:56 1011k\r 25  334M   25 86.8M    0     0   860k      0  0:06:37  0:01:43  0:04:54 1029k\r 26  334M   26 87.9M    0     0   862k      0  0:06:36  0:01:44  0:04:52 1047k\r 26  334M   26 88.8M    0     0   864k      0  0:06:36  0:01:45  0:04:51 1049k\r 26  334M   26 90.1M    0     0   867k      0  0:06:34  0:01:46  0:04:48 1089k\r 27  334M   27 91.3M    0     0   871k      0  0:06:32  0:01:47  0:04:45 1127k\r 27  334M   27 92.7M    0     0   876k      0  0:06:30  0:01:48  0:04:42 1217k\r 28  334M   28 93.8M    0     0   879k      0  0:06:29  0:01:49  0:04:40 1220k\r 28  334M   28 95.5M    0     0   886k      0  0:06:26  0:01:50  0:04:36 1352k\r 29  334M   29 97.0M    0     0   892k      0  0:06:23  0:01:51  0:04:32 1422k\r 29  334M   29 98.6M    0     0   899k      0  0:06:20  0:01:52  0:04:28 1485k\r 30  334M   30  100M    0     0   906k      0  0:06:17  0:01:53  0:04:24 1549k\r 30  334M   30  102M    0     0   914k      0  0:06:14  0:01:54  0:04:20 1685k\r 31  334M   31  103M    0     0   921k      0  0:06:11  0:01:55  0:04:16 1691k\r 31  334M   31  105M    0     0   929k      0  0:06:08  0:01:56  0:04:12 1753k\r 32  334M   32  107M    0     0   936k      0  0:06:05  0:01:57  0:04:08 1780k\r 32  334M   32  109M    0     0   944k      0  0:06:02  0:01:58  0:04:04 1802k\r 33  334M   33  110M    0     0   951k      0  0:05:59  0:01:59  0:04:00 1808k\r 33  334M   33  112M    0     0   959k      0  0:05:56  0:02:00  0:03:56 1833k\r 34  334M   34  114M    0     0   968k      0  0:05:53  0:02:01  0:03:52 1876k\r 34  334M   34  116M    0     0   978k      0  0:05:49  0:02:02  0:03:47 1955k\r 35  334M   35  119M    0     0   990k      0  0:05:45  0:02:03  0:03:42 2088k\r 36  334M   36  122M    0     0  1004k      0  0:05:40  0:02:04  0:03:36 2269k\r 37  334M   37  125M    0     0  1022k      0  0:05:34  0:02:05  0:03:29 2548k\r 38  334M   38  128M    0     0  1045k      0  0:05:27  0:02:06  0:03:21 2900k\r 39  334M   39  132M    0     0  1063k      0  0:05:21  0:02:07  0:03:14 3141k\r 40  334M   40  134M    0     0  1074k      0  0:05:18  0:02:08  0:03:10 3141k\r 40  334M   40  136M    0     0  1082k      0  0:05:16  0:02:09  0:03:07 3022k\r 41  334M   41  138M    0     0  1089k      0  0:05:14  0:02:10  0:03:04 2753k\r 42  334M   42  140M    0     0  1095k      0  0:05:12  0:02:11  0:03:01 2359k\r 42  334M   42  142M    0     0  1101k      0  0:05:10  0:02:12  0:02:58 2082k\r 43  334M   43  144M    0     0  1108k      0  0:05:08  0:02:13  0:02:55 1990k\r 43  334M   43  146M    0     0  1113k      0  0:05:07  0:02:14  0:02:53 1900k\r 44  334M   44  147M    0     0  1114k      0  0:05:07  0:02:15  0:02:52 1777k\r 44  334M   44  148M    0     0  1114k      0  0:05:07  0:02:16  0:02:51 1614k\r 44  334M   44  149M    0     0  1115k      0  0:05:06  0:02:17  0:02:49 1473k\r 45  334M   45  150M    0     0  1116k      0  0:05:06  0:02:18  0:02:48 1313k\r 45  334M   45  152M    0     0  1117k      0  0:05:06  0:02:19  0:02:47 1221k\r 45  334M   45  153M    0     0  1118k      0  0:05:06  0:02:20  0:02:46 1225k\r 46  334M   46  154M    0     0  1119k      0  0:05:05  0:02:21  0:02:44 1249k\r 46  334M   46  155M    0     0  1120k      0  0:05:05  0:02:22  0:02:43 1267k\r 46  334M   46  157M    0     0  1121k      0  0:05:05  0:02:23  0:02:42 1277k\r 47  334M   47  158M    0     0  1123k      0  0:05:04  0:02:24  0:02:40 1308k\r 47  334M   47  159M    0     0  1126k      0  0:05:03  0:02:25  0:02:38 1363k\r 48  334M   48  161M    0     0  1128k      0  0:05:03  0:02:26  0:02:37 1391k\r 48  334M   48  162M    0     0  1130k      0  0:05:02  0:02:27  0:02:35 1405k\r 49  334M   49  164M    0     0  1132k      0  0:05:02  0:02:28  0:02:34 1434k\r 49  334M   49  165M    0     0  1135k      0  0:05:01  0:02:29  0:02:32 1484k\r 50  334M   50  167M    0     0  1139k      0  0:05:00  0:02:30  0:02:30 1505k\r 50  334M   50  168M    0     0  1142k      0  0:04:59  0:02:31  0:02:28 1570k\r 51  334M   51  170M    0     0  1146k      0  0:04:58  0:02:32  0:02:26 1638k\r 51  334M   51  172M    0     0  1150k      0  0:04:57  0:02:33  0:02:24 1679k\r 52  334M   52  173M    0     0  1154k      0  0:04:56  0:02:34  0:02:22 1697k\r 52  334M   52  175M    0     0  1157k      0  0:04:55  0:02:35  0:02:20 1699k\r 52  334M   52  177M    0     0  1159k      0  0:04:55  0:02:36  0:02:19 1672k\r 53  334M   53  178M    0     0  1162k      0  0:04:54  0:02:37  0:02:17 1645k\r 53  334M   53  180M    0     0  1164k      0  0:04:53  0:02:38  0:02:15 1620k\r 54  334M   54  181M    0     0  1168k      0  0:04:52  0:02:39  0:02:13 1609k\r 54  334M   54  183M    0     0  1171k      0  0:04:52  0:02:40  0:02:12 1614k\r 55  334M   55  185M    0     0  1175k      0  0:04:51  0:02:41  0:02:10 1678k\r 55  334M   55  187M    0     0  1179k      0  0:04:50  0:02:42  0:02:08 1720k\r 56  334M   56  188M    0     0  1183k      0  0:04:49  0:02:43  0:02:06 1773k\r 57  334M   57  190M    0     0  1187k      0  0:04:48  0:02:44  0:02:04 1802k\r 57  334M   57  192M    0     0  1191k      0  0:04:47  0:02:45  0:02:02 1825k\r 58  334M   58  194M    0     0  1195k      0  0:04:46  0:02:46  0:02:00 1832k\r 58  334M   58  196M    0     0  1200k      0  0:04:45  0:02:47  0:01:58 1850k\r 59  334M   59  198M    0     0  1205k      0  0:04:44  0:02:48  0:01:56 1903k\r 59  334M   59  200M    0     0  1211k      0  0:04:42  0:02:49  0:01:53 1995k\r 60  334M   60  202M    0     0  1218k      0  0:04:40  0:02:50  0:01:50 2114k\r 61  334M   61  205M    0     0  1228k      0  0:04:38  0:02:51  0:01:47 2315k\r 62  334M   62  208M    0     0  1239k      0  0:04:36  0:02:52  0:01:44 2567k\r 63  334M   63  212M    0     0  1254k      0  0:04:32  0:02:53  0:01:39 2921k\r 64  334M   64  216M    0     0  1273k      0  0:04:28  0:02:54  0:01:34 3373k\r 65  334M   65  220M    0     0  1287k      0  0:04:25  0:02:55  0:01:30 3627k\r 66  334M   66  223M    0     0  1296k      0  0:04:24  0:02:56  0:01:28 3626k\r 67  334M   67  225M    0     0  1301k      0  0:04:23  0:02:57  0:01:26 3418k\r 68  334M   68  227M    0     0  1305k      0  0:04:22  0:02:58  0:01:24 3072k\r 68  334M   68  229M    0     0  1310k      0  0:04:21  0:02:59  0:01:22 2599k\r 69  334M   69  231M    0     0  1312k      0  0:04:20  0:03:00  0:01:20 2171k\r 69  334M   69  233M    0     0  1317k      0  0:04:19  0:03:01  0:01:18 2041k\r 70  334M   70  234M    0     0  1319k      0  0:04:19  0:03:02  0:01:17 1962k\r 70  334M   70  236M    0     0  1322k      0  0:04:18  0:03:03  0:01:15 1910k\r 71  334M   71  238M    0     0  1325k      0  0:04:18  0:03:04  0:01:14 1846k\r 71  334M   71  240M    0     0  1327k      0  0:04:17  0:03:05  0:01:12 1903k\r 72  334M   72  242M    0     0  1331k      0  0:04:17  0:03:06  0:01:11 1845k\r 73  334M   73  244M    0     0  1334k      0  0:04:16  0:03:07  0:01:09 1875k\r 73  334M   73  245M    0     0  1337k      0  0:04:16  0:03:08  0:01:08 1889k\r 74  334M   74  247M    0     0  1340k      0  0:04:15  0:03:09  0:01:06 1903k\r 74  334M   74  249M    0     0  1343k      0  0:04:14  0:03:10  0:01:04 1930k\r 75  334M   75  251M    0     0  1348k      0  0:04:13  0:03:11  0:01:02 1974k\r 75  334M   75  254M    0     0  1352k      0  0:04:13  0:03:12  0:01:01 2040k\r 76  334M   76  256M    0     0  1358k      0  0:04:11  0:03:13  0:00:58 2177k\r 77  334M   77  259M    0     0  1366k      0  0:04:10  0:03:14  0:00:56 2363k\r 78  334M   78  262M    0     0  1376k      0  0:04:08  0:03:15  0:00:53 2616k\r 78  334M   78  263M    0     0  1360k      0  0:04:11  0:03:18  0:00:53 1726k\r 78  334M   78  263M    0     0  1358k      0  0:04:12  0:03:18  0:00:54 1534k\r 79  334M   79  266M    0     0  1370k      0  0:04:09  0:03:19  0:00:50 1756k\r 79  334M   79  267M    0     0  1366k      0  0:04:10  0:03:20  0:00:50 1349k\r 80  334M   80  268M    0     0  1364k      0  0:04:10  0:03:21  0:00:49  976k\r 80  334M   80  268M    0     0  1361k      0  0:04:11  0:03:22  0:00:49 1369k\r 80  334M   80  269M    0     0  1358k      0  0:04:11  0:03:23  0:00:48 1371k\r 80  334M   80  270M    0     0  1355k      0  0:04:12  0:03:24  0:00:48  753k\r 81  334M   81  271M    0     0  1352k      0  0:04:13  0:03:25  0:00:48  824k\r 81  334M   81  272M    0     0  1350k      0  0:04:13  0:03:26  0:00:47  811k\r 81  334M   81  272M    0     0  1347k      0  0:04:13  0:03:27  0:00:46  810k\r 81  334M   81  273M    0     0  1345k      0  0:04:14  0:03:28  0:00:46  835k\r 82  334M   82  274M    0     0  1344k      0  0:04:14  0:03:29  0:00:45  868k\r 82  334M   82  275M    0     0  1342k      0  0:04:14  0:03:30  0:00:44  925k\r 82  334M   82  277M    0     0  1342k      0  0:04:15  0:03:31  0:00:44  987k\r 83  334M   83  278M    0     0  1343k      0  0:04:14  0:03:32  0:00:42 1141k\r 83  334M   83  280M    0     0  1346k      0  0:04:14  0:03:33  0:00:41 1362k\r 84  334M   84  282M    0     0  1350k      0  0:04:13  0:03:34  0:00:39 1620k\r 85  334M   85  285M    0     0  1358k      0  0:04:12  0:03:35  0:00:37 2001k\r 86  334M   86  288M    0     0  1364k      0  0:04:10  0:03:36  0:00:34 2296k\r 86  334M   86  289M    0     0  1365k      0  0:04:10  0:03:37  0:00:33 2261k\r 87  334M   87  291M    0     0  1367k      0  0:04:10  0:03:38  0:00:32 2262k\r 87  334M   87  292M    0     0  1367k      0  0:04:10  0:03:39  0:00:31 2080k\r 88  334M   88  294M    0     0  1368k      0  0:04:10  0:03:40  0:00:30 1805k\r 88  334M   88  295M    0     0  1368k      0  0:04:10  0:03:41  0:00:29 1553k\r 88  334M   88  297M    0     0  1369k      0  0:04:09  0:03:42  0:00:27 1580k\r 89  334M   89  298M    0     0  1370k      0  0:04:09  0:03:43  0:00:26 1520k\r 89  334M   89  300M    0     0  1371k      0  0:04:09  0:03:44  0:00:25 1559k\r 90  334M   90  302M    0     0  1372k      0  0:04:09  0:03:45  0:00:24 1573k\r 90  334M   90  303M    0     0  1373k      0  0:04:09  0:03:46  0:00:23 1584k\r 91  334M   91  305M    0     0  1375k      0  0:04:08  0:03:47  0:00:21 1619k\r 91  334M   91  307M    0     0  1376k      0  0:04:08  0:03:48  0:00:20 1647k\r 92  334M   92  308M    0     0  1379k      0  0:04:08  0:03:49  0:00:19 1732k\r 93  334M   93  311M    0     0  1383k      0  0:04:07  0:03:50  0:00:17 1850k\r 93  334M   93  313M    0     0  1387k      0  0:04:06  0:03:51  0:00:15 2023k\r 94  334M   94  316M    0     0  1394k      0  0:04:05  0:03:52  0:00:13 2296k\r 95  334M   95  319M    0     0  1403k      0  0:04:03  0:03:53  0:00:10 2612k\r 96  334M   96  323M    0     0  1415k      0  0:04:01  0:03:54  0:00:07 3047k\r 97  334M   97  327M    0     0  1423k      0  0:04:00  0:03:55  0:00:05 3271k\r 98  334M   98  330M    0     0  1431k      0  0:03:59  0:03:56  0:00:03 3446k\r 99  334M   99  332M    0     0  1436k      0  0:03:58  0:03:57  0:00:01 3371k\r100  334M  100  334M    0     0  1439k      0  0:03:57  0:03:57 --:--:-- 3310k\n0+28275 records in\n0+28275 records out\n645262336 bytes (645 MB, 615 MiB) copied, 265.626 s, 2.4 MB/s\n+ sync\n+ partprobe /dev/sda\n+ mount /dev/sda2 /mnt\n+ cp -a /snap/cm3-installer/6/extrausers /mnt/system-data/var/lib/\n+ mkdir -p /mnt/user-data/ubuntu\n+ chown -R 1000.1000 /mnt/user-data/ubuntu\n+ mkdir -p /mnt/system-data/etc/sudoers.d\n+ echo 'ubuntu ALL=(ALL) NOPASSWD:ALL'\n+ umount /mnt\n"
2018-08-21 04:36:05,351 cm3-001 INFO: b"Warning: Permanently added '10.101.50.180' (ECDSA) to the list of known hosts.\r\n"
2018-08-21 04:36:16,680 cm3-001 INFO: Running snmpset -c private -v1 10.101.48.8 .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 i 2
iso.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 = INTEGER: 2
2018-08-21 04:36:16,798 cm3-001 INFO: Running sleep 10
2018-08-21 04:36:26,824 cm3-001 INFO: Running snmpset -c private -v1 10.101.48.8 .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 i 1
iso.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1 = INTEGER: 1
2018-08-21 04:36:26,943 cm3-001 INFO: Checking if test image booted.
2018-08-21 04:36:57,447 cm3-001 INFO: END provision

**********************************

* Starting test phase on cm3-001 *

**********************************
Install python-logstash if you want to use logstash logging
2018-08-21 04:37:01,397 cm3-001 INFO: BEGIN testrun

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease [107 kB]
Hit:2 http://archive.ubuntu.com/ubuntu xenial InRelease
Get:3 http://ppa.launchpad.net/checkbox-dev/ppa/ubuntu xenial InRelease [17.6 kB]
Get:4 http://archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB]
Get:5 http://security.ubuntu.com/ubuntu xenial-security/universe Sources [88.1 kB]
Get:6 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [688 kB]
Get:7 http://ppa.launchpad.net/checkbox-dev/ppa/ubuntu xenial/main amd64 Packages [9812 B]
Get:8 http://archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB]
Get:9 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [465 kB]
Get:10 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [3748 B]
Get:11 http://archive.ubuntu.com/ubuntu xenial-updates/universe Sources [275 kB]
Get:12 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [1073 kB]
Get:13 http://archive.ubuntu.com/ubuntu xenial-updates/restricted amd64 Packages [13.1 kB]
Get:14 http://archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [876 kB]
Get:15 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [18.8 kB]
Get:16 http://archive.ubuntu.com/ubuntu xenial-backports/main amd64 Packages [7343 B]
Fetched 3857 kB in 3s (1035 kB/s)
Reading package lists...
Building dependency tree...
Reading state information...
28 packages can be upgraded. Run 'apt list --upgradable' to see them.

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Reading package lists...
Building dependency tree...
Reading state information...
The following additional packages will be installed:
  git-man ifupdown iproute2 isc-dhcp-client isc-dhcp-common less libatm1
  libdns-export162 liberror-perl libgdbm3 libisc-export160 libmnl0 libperl5.22
  libxtables11 netbase patch perl perl-base perl-modules-5.22 rename rsync
Suggested packages:
  gettext-base git-daemon-run | git-daemon-sysvinit git-doc git-el git-email
  git-gui gitk gitweb git-arch git-cvs git-mediawiki git-svn ppp rdnssd
  iproute2-doc resolvconf avahi-autoipd isc-dhcp-client-ddns apparmor ed
  diffutils-doc perl-doc libterm-readline-gnu-perl
  | libterm-readline-perl-perl make openssh-server
The following NEW packages will be installed:
  curl git git-man ifupdown iproute2 isc-dhcp-client isc-dhcp-common less
  libatm1 libdns-export162 liberror-perl libgdbm3 libisc-export160 libmnl0
  libperl5.22 libxtables11 netbase patch perl perl-modules-5.22 rename rsync
  sshpass
The following packages will be upgraded:
  perl-base
1 upgraded, 23 newly installed, 0 to remove and 27 not upgraded.
Need to get 14.0 MB of archives.
After this operation, 71.9 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 perl-base amd64 5.22.1-9ubuntu0.5 [1284 kB]
Get:2 http://archive.ubuntu.com/ubuntu xenial/main amd64 libatm1 amd64 1:2.5.1-1.5 [24.2 kB]
Get:3 http://archive.ubuntu.com/ubuntu xenial/main amd64 libmnl0 amd64 1.0.3-5 [12.0 kB]
Get:4 http://archive.ubuntu.com/ubuntu xenial/main amd64 libgdbm3 amd64 1.8.3-13.1 [16.9 kB]
Get:5 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 perl-modules-5.22 all 5.22.1-9ubuntu0.5 [2645 kB]
Get:6 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libperl5.22 amd64 5.22.1-9ubuntu0.5 [3396 kB]
Get:7 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 perl amd64 5.22.1-9ubuntu0.5 [238 kB]
Get:8 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 iproute2 amd64 4.3.0-1ubuntu3.16.04.3 [522 kB]
Get:9 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 ifupdown amd64 0.8.10ubuntu1.4 [54.9 kB]
Get:10 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libisc-export160 amd64 1:9.10.3.dfsg.P4-8ubuntu1.10 [153 kB]
Get:11 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libdns-export162 amd64 1:9.10.3.dfsg.P4-8ubuntu1.10 [666 kB]
Get:12 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 isc-dhcp-client amd64 4.3.3-5ubuntu12.10 [224 kB]
Get:13 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 isc-dhcp-common amd64 4.3.3-5ubuntu12.10 [105 kB]
Get:14 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 less amd64 481-2.1ubuntu0.2 [110 kB]
Get:15 http://archive.ubuntu.com/ubuntu xenial/main amd64 libxtables11 amd64 1.6.0-2ubuntu3 [27.2 kB]
Get:16 http://archive.ubuntu.com/ubuntu xenial/main amd64 netbase all 5.3 [12.9 kB]
Get:17 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 rsync amd64 3.1.1-3ubuntu1.2 [329 kB]
Get:18 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 curl amd64 7.47.0-1ubuntu2.8 [139 kB]
Get:19 http://archive.ubuntu.com/ubuntu xenial/main amd64 liberror-perl all 0.17-1.2 [19.6 kB]
Get:20 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 git-man all 1:2.7.4-0ubuntu1.4 [736 kB]
Get:21 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 git amd64 1:2.7.4-0ubuntu1.4 [3158 kB]
Get:22 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 patch amd64 2.7.5-1ubuntu0.16.04.1 [90.5 kB]
Get:23 http://archive.ubuntu.com/ubuntu xenial/main amd64 rename all 0.20-4 [12.0 kB]
Get:24 http://archive.ubuntu.com/ubuntu xenial/universe amd64 sshpass amd64 1.05-1 [10.5 kB]
debconf: unable to initialize frontend: Dialog
debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, <> line 24.)
debconf: falling back to frontend: Readline
debconf: unable to initialize frontend: Readline
debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.22.1 /usr/local/share/perl/5.22.1 /usr/lib/x86_64-linux-gnu/perl5/5.22 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.22 /usr/share/perl/5.22 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 24.)
debconf: falling back to frontend: Teletype
Fetched 14.0 MB in 4s (3209 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 14264 files and directories currently installed.)
Preparing to unpack .../perl-base_5.22.1-9ubuntu0.5_amd64.deb ...
Unpacking perl-base (5.22.1-9ubuntu0.5) over (5.22.1-9ubuntu0.3) ...
Setting up perl-base (5.22.1-9ubuntu0.5) ...
Selecting previously unselected package libatm1:amd64.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 14264 files and directories currently installed.)
Preparing to unpack .../libatm1_1%3a2.5.1-1.5_amd64.deb ...
Unpacking libatm1:amd64 (1:2.5.1-1.5) ...
Selecting previously unselected package libmnl0:amd64.
Preparing to unpack .../libmnl0_1.0.3-5_amd64.deb ...
Unpacking libmnl0:amd64 (1.0.3-5) ...
Selecting previously unselected package libgdbm3:amd64.
Preparing to unpack .../libgdbm3_1.8.3-13.1_amd64.deb ...
Unpacking libgdbm3:amd64 (1.8.3-13.1) ...
Selecting previously unselected package perl-modules-5.22.
Preparing to unpack .../perl-modules-5.22_5.22.1-9ubuntu0.5_all.deb ...
Unpacking perl-modules-5.22 (5.22.1-9ubuntu0.5) ...
Selecting previously unselected package libperl5.22:amd64.
Preparing to unpack .../libperl5.22_5.22.1-9ubuntu0.5_amd64.deb ...
Unpacking libperl5.22:amd64 (5.22.1-9ubuntu0.5) ...
Selecting previously unselected package perl.
Preparing to unpack .../perl_5.22.1-9ubuntu0.5_amd64.deb ...
Unpacking perl (5.22.1-9ubuntu0.5) ...
Selecting previously unselected package iproute2.
Preparing to unpack .../iproute2_4.3.0-1ubuntu3.16.04.3_amd64.deb ...
Unpacking iproute2 (4.3.0-1ubuntu3.16.04.3) ...
Selecting previously unselected package ifupdown.
Preparing to unpack .../ifupdown_0.8.10ubuntu1.4_amd64.deb ...
Unpacking ifupdown (0.8.10ubuntu1.4) ...
Selecting previously unselected package libisc-export160.
Preparing to unpack .../libisc-export160_1%3a9.10.3.dfsg.P4-8ubuntu1.10_amd64.deb ...
Unpacking libisc-export160 (1:9.10.3.dfsg.P4-8ubuntu1.10) ...
Selecting previously unselected package libdns-export162.
Preparing to unpack .../libdns-export162_1%3a9.10.3.dfsg.P4-8ubuntu1.10_amd64.deb ...
Unpacking libdns-export162 (1:9.10.3.dfsg.P4-8ubuntu1.10) ...
Selecting previously unselected package isc-dhcp-client.
Preparing to unpack .../isc-dhcp-client_4.3.3-5ubuntu12.10_amd64.deb ...
Unpacking isc-dhcp-client (4.3.3-5ubuntu12.10) ...
Selecting previously unselected package isc-dhcp-common.
Preparing to unpack .../isc-dhcp-common_4.3.3-5ubuntu12.10_amd64.deb ...
Unpacking isc-dhcp-common (4.3.3-5ubuntu12.10) ...
Selecting previously unselected package less.
Preparing to unpack .../less_481-2.1ubuntu0.2_amd64.deb ...
Unpacking less (481-2.1ubuntu0.2) ...
Selecting previously unselected package libxtables11:amd64.
Preparing to unpack .../libxtables11_1.6.0-2ubuntu3_amd64.deb ...
Unpacking libxtables11:amd64 (1.6.0-2ubuntu3) ...
Selecting previously unselected package netbase.
Preparing to unpack .../archives/netbase_5.3_all.deb ...
Unpacking netbase (5.3) ...
Selecting previously unselected package rsync.
Preparing to unpack .../rsync_3.1.1-3ubuntu1.2_amd64.deb ...
Unpacking rsync (3.1.1-3ubuntu1.2) ...
Selecting previously unselected package curl.
Preparing to unpack .../curl_7.47.0-1ubuntu2.8_amd64.deb ...
Unpacking curl (7.47.0-1ubuntu2.8) ...
Selecting previously unselected package liberror-perl.
Preparing to unpack .../liberror-perl_0.17-1.2_all.deb ...
Unpacking liberror-perl (0.17-1.2) ...
Selecting previously unselected package git-man.
Preparing to unpack .../git-man_1%3a2.7.4-0ubuntu1.4_all.deb ...
Unpacking git-man (1:2.7.4-0ubuntu1.4) ...
Selecting previously unselected package git.
Preparing to unpack .../git_1%3a2.7.4-0ubuntu1.4_amd64.deb ...
Unpacking git (1:2.7.4-0ubuntu1.4) ...
Selecting previously unselected package patch.
Preparing to unpack .../patch_2.7.5-1ubuntu0.16.04.1_amd64.deb ...
Unpacking patch (2.7.5-1ubuntu0.16.04.1) ...
Selecting previously unselected package rename.
Preparing to unpack .../archives/rename_0.20-4_all.deb ...
Unpacking rename (0.20-4) ...
Selecting previously unselected package sshpass.
Preparing to unpack .../sshpass_1.05-1_amd64.deb ...
Unpacking sshpass (1.05-1) ...
Processing triggers for systemd (229-4ubuntu21.3) ...
Processing triggers for libc-bin (2.23-0ubuntu10) ...
Processing triggers for mime-support (3.59ubuntu1) ...
Setting up libatm1:amd64 (1:2.5.1-1.5) ...
Setting up libmnl0:amd64 (1.0.3-5) ...
Setting up libgdbm3:amd64 (1.8.3-13.1) ...
Setting up perl-modules-5.22 (5.22.1-9ubuntu0.5) ...
Setting up libperl5.22:amd64 (5.22.1-9ubuntu0.5) ...
Setting up perl (5.22.1-9ubuntu0.5) ...
update-alternatives: using /usr/bin/prename to provide /usr/bin/rename (rename) in auto mode
Setting up iproute2 (4.3.0-1ubuntu3.16.04.3) ...
Setting up ifupdown (0.8.10ubuntu1.4) ...
Creating /etc/network/interfaces.
Setting up libisc-export160 (1:9.10.3.dfsg.P4-8ubuntu1.10) ...
Setting up libdns-export162 (1:9.10.3.dfsg.P4-8ubuntu1.10) ...
Setting up isc-dhcp-client (4.3.3-5ubuntu12.10) ...
Setting up isc-dhcp-common (4.3.3-5ubuntu12.10) ...
Setting up less (481-2.1ubuntu0.2) ...
debconf: unable to initialize frontend: Dialog
debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76.)
debconf: falling back to frontend: Readline
Setting up libxtables11:amd64 (1.6.0-2ubuntu3) ...
Setting up netbase (5.3) ...
Setting up rsync (3.1.1-3ubuntu1.2) ...
invoke-rc.d: could not determine current runlevel
invoke-rc.d: policy-rc.d denied execution of restart.
Setting up curl (7.47.0-1ubuntu2.8) ...
Setting up liberror-perl (0.17-1.2) ...
Setting up git-man (1:2.7.4-0ubuntu1.4) ...
Setting up git (1:2.7.4-0ubuntu1.4) ...
Setting up patch (2.7.5-1ubuntu0.16.04.1) ...
Setting up rename (0.20-4) ...
update-alternatives: using /usr/bin/file-rename to provide /usr/bin/rename (rename) in auto mode
Setting up sshpass (1.05-1) ...
Processing triggers for libc-bin (2.23-0ubuntu10) ...
Processing triggers for systemd (229-4ubuntu21.3) ...
Cloning into 'snappy-qa-jobs'...
Already on 'master'
Your branch is up-to-date with 'origin/master'.
Cloning into 'snapd'...
Already on 'master'
Your branch is up-to-date with 'origin/master'.
++ INSTANCE_IP=10.101.50.181
++ INSTANCE_PORT=22
++ USER=ubuntu
++ execute_remote 'sudo adduser --extrausers --quiet --disabled-password --gecos '\'''\'' test'
++ ssh -q -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 22 ubuntu@10.101.50.181 'sudo adduser --extrausers --quiet --disabled-password --gecos '\'''\'' test'
ENTER EXTRAUSERS_GROUP_FILEEXIT EXTRAUSERS_GROUP_FILEENTER EXTRAUSERS_SHADOWGROUP_FILEEXIT EXTRAUSERS_SHADOWGROUP_FILE++ execute_remote 'echo test:ubuntu | sudo chpasswd'
++ ssh -q -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 22 ubuntu@10.101.50.181 'echo test:ubuntu | sudo chpasswd'
++ execute_remote 'echo '\''test ALL=(ALL) NOPASSWD:ALL'\'' | sudo tee /etc/sudoers.d/create-user-test'
++ ssh -q -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 22 ubuntu@10.101.50.181 'echo '\''test ALL=(ALL) NOPASSWD:ALL'\'' | sudo tee /etc/sudoers.d/create-user-test'
test ALL=(ALL) NOPASSWD:ALL
+ . snappy-qa-jobs/scripts/utils/register_device.sh 10.101.50.181 22 test ubuntu sergiocazzolato@yahoo.com.ar
++ echo 'Register device'
Register device
++ '[' 5 -ne 5 ']'
++ DEVICE_IP=10.101.50.181
++ DEVICE_PORT=22
++ USER=test
++ PASS=ubuntu
++ EMAIL=sergiocazzolato@yahoo.com.ar
++ SCRIPT='sudo snap create-user sergiocazzolato@yahoo.com.ar ||         ( sudo snap install jq;         sudo cp /var/lib/snapd/state.json /var/lib/snapd/state.json.bak;         sudo cat /var/lib/snapd/state.json.bak | jq -r '\''.data.auth.users=[]'\'' | sudo tee /var/lib/snapd/state.json > /dev/null;         sudo systemctl stop snapd.service snapd.socket;         sudo systemctl start snapd.service snapd.socket;         sudo snap create-user sergiocazzolato@yahoo.com.ar;         sudo snap remove jq )'
++ '[' -z sergiocazzolato@yahoo.com.ar ']'
++ '[' -z ubuntu ']'
++ echo 'Registering device (with pass): sudo snap create-user sergiocazzolato@yahoo.com.ar ||         ( sudo snap install jq;         sudo cp /var/lib/snapd/state.json /var/lib/snapd/state.json.bak;         sudo cat /var/lib/snapd/state.json.bak | jq -r '\''.data.auth.users=[]'\'' | sudo tee /var/lib/snapd/state.json > /dev/null;         sudo systemctl stop snapd.service snapd.socket;         sudo systemctl start snapd.service snapd.socket;         sudo snap create-user sergiocazzolato@yahoo.com.ar;         sudo snap remove jq )'
Registering device (with pass): sudo snap create-user sergiocazzolato@yahoo.com.ar ||         ( sudo snap install jq;         sudo cp /var/lib/snapd/state.json /var/lib/snapd/state.json.bak;         sudo cat /var/lib/snapd/state.json.bak | jq -r '.data.auth.users=[]' | sudo tee /var/lib/snapd/state.json > /dev/null;         sudo systemctl stop snapd.service snapd.socket;         sudo systemctl start snapd.service snapd.socket;         sudo snap create-user sergiocazzolato@yahoo.com.ar;         sudo snap remove jq )
++ sshpass -p ubuntu ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 22 test@10.101.50.181 'sudo snap create-user sergiocazzolato@yahoo.com.ar ||         ( sudo snap install jq;         sudo cp /var/lib/snapd/state.json /var/lib/snapd/state.json.bak;         sudo cat /var/lib/snapd/state.json.bak | jq -r '\''.data.auth.users=[]'\'' | sudo tee /var/lib/snapd/state.json > /dev/null;         sudo systemctl stop snapd.service snapd.socket;         sudo systemctl start snapd.service snapd.socket;         sudo snap create-user sergiocazzolato@yahoo.com.ar;         sudo snap remove jq )'
Warning: Permanently added '10.101.50.181' (ECDSA) to the list of known hosts.
created user "snappytestaccount1"
+ . snappy-qa-jobs/scripts/utils/refresh.sh 10.101.50.181 22 test ubuntu stable edge
++ echo 'Refresh core on device'
Refresh core on device
++ '[' 6 -ne 6 ']'
++ DEVICE_IP=10.101.50.181
++ DEVICE_PORT=22
++ USER=test
++ PASS=ubuntu
++ CHANNEL=stable
++ CORE_CHANNEL=edge
++ grep -q -E 'Doing.*Auto-refresh snap.*'
++ execute_remote 'snap changes'
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 'snap changes'
++ '[' -z edge ']'
++ '[' stable = edge ']'
++ do_core_refresh edge core
++ refresh_channel=edge
++ execute_remote 'sudo snap refresh --edge core'
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 'sudo snap refresh --edge core'
2018-08-21T04:45:21Z INFO Waiting for restart...
2018-08-21T04:47:19Z INFO Waiting for restart...
2018-08-21T04:47:51Z INFO Waiting for restart...
2018-08-21T04:47:53Z INFO Waiting for restart...
2018-08-21T04:47:54Z INFO Waiting for restart...
2018-08-21T04:47:55Z INFO Waiting for restart...
2018-08-21T04:47:56Z INFO Waiting for restart...
2018-08-21T04:48:11Z INFO Waiting for restart...
2018-08-21T04:53:11Z INFO Waiting for restart...
Connection to 10.101.50.181 closed by remote host.
++ true
++ check_refresh edge
++ refresh_channel=edge
++ wait_for_ssh 120 2
++ retries=120
++ sleep=2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=119
++ '[' 119 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=118
++ '[' 118 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=117
++ '[' 117 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=116
++ '[' 116 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=115
++ '[' 115 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=114
++ '[' 114 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retries=113
++ '[' 113 -le 0 ']'
++ sleep 2
++ execute_remote true
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 true
++ retry_until 'snap info core' 'tracking: +edge' 10 2
++ command='snap info core'
++ output='tracking: +edge'
++ retries=10
++ sleep=2
++ execute_remote 'snap info core'
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 'snap info core'
++ grep -q -E 'tracking: +edge'
++ retry_until 'sudo snap install --devmode jq' 'jq .* installed' 20 10
++ command='sudo snap install --devmode jq'
++ output='jq .* installed'
++ retries=20
++ sleep=10
++ execute_remote 'sudo snap install --devmode jq'
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 'sudo snap install --devmode jq'
++ grep -q -E 'jq .* installed'
error: cannot install "jq": Post https://api.snapcraft.io/v2/snaps/refresh:
       dial tcp: lookup api.snapcraft.io on [::1]:53: read udp
       [::1]:44232->[::1]:53: read: connection refused
++ retries=19
++ '[' 19 -le 0 ']'
++ sleep 10
++ execute_remote 'sudo snap install --devmode jq'
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 'sudo snap install --devmode jq'
++ grep -q -E 'jq .* installed'
++ execute_remote 'sudo snap remove jq'
++ '[' -z ubuntu ']'
++ sshpass -p ubuntu ssh -p 22 -q -o ConnectTimeout=10 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no test@10.101.50.181 'sudo snap remove jq'
jq removed
+ . snappy-qa-jobs/scripts/utils/run_setup.sh 10.101.50.181 22 test ubuntu ''
++ echo 'Running setup command'
Running setup command
++ '[' 5 -ne 5 ']'
++ DEVICE_IP=10.101.50.181
++ DEVICE_PORT=22
++ USER=test
++ PASS=ubuntu
++ SETUP=
++ '[' -z '' ']'
++ echo 'No setup command to run'
No setup command to run
+ . snappy-qa-jobs/scripts/utils/get_spread.sh
++ echo 'Getting spread'
Getting spread
+++ pwd
++ export WORKSPACE=/home/ubuntu
++ WORKSPACE=/home/ubuntu
++ export SPREAD_DIR=/home/ubuntu/spread
++ SPREAD_DIR=/home/ubuntu/spread
++ export PATH=/home/ubuntu/spread:/srv/testflinger-agent/cm3001/env/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ PATH=/home/ubuntu/spread:/srv/testflinger-agent/cm3001/env/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ '[' -f /home/ubuntu/spread/spread ']'
++ mkdir -p /home/ubuntu/spread
++ cd /home/ubuntu/spread
++ curl -s -O https://niemeyer.s3.amazonaws.com/spread-amd64.tar.gz
++ tar xzvf spread-amd64.tar.gz
spread
++ echo 'Spread downloaded and ready to use'
Spread downloaded and ready to use
+ . snappy-qa-jobs/scripts/utils/run_spread.sh 10.101.50.181 22 snapd external:ubuntu-core-16-arm-32:tests/ '' tests/main/auto-refresh,tests/main/interfaces-content -v
++ echo 'Running spread'
Running spread
++ '[' 7 -ne 7 ']'
++ export WORKSPACE=/home/ubuntu
++ WORKSPACE=/home/ubuntu
++ DEVICE_IP=10.101.50.181
++ DEVICE_PORT=22
++ PROJECT_PATH=snapd
++ SPREAD_TESTS=external:ubuntu-core-16-arm-32:tests/
++ SPREAD_ENV=
++ SKIP_TESTS=tests/main/auto-refresh,tests/main/interfaces-content
++ SPREAD_PARAMS=-v
++ '[' -z external:ubuntu-core-16-arm-32:tests/ ']'
++ '[' '!' -z '' ']'
++ export SPREAD_EXTERNAL_ADDRESS=10.101.50.181:22
++ SPREAD_EXTERNAL_ADDRESS=10.101.50.181:22
+++ which spread
++ [[ -n /home/ubuntu/spread/spread ]]
++ echo 'Spread found'
Spread found
++ cd snapd
++ echo 'Moving to manual all the tests to skip: tests/main/auto-refresh,tests/main/interfaces-content'
Moving to manual all the tests to skip: tests/main/auto-refresh,tests/main/interfaces-content
+++ echo tests/main/auto-refresh,tests/main/interfaces-content
+++ tr , ' '
++ tests_skip='tests/main/auto-refresh tests/main/interfaces-content'
++ for test in '$tests_skip'
++ '[' -f tests/main/auto-refresh/task.yaml ']'
++ cp tests/main/auto-refresh/task.yaml tests/main/auto-refresh/task.yaml.back
++ echo 'manual: true'
++ for test in '$tests_skip'
++ '[' -f tests/main/interfaces-content/task.yaml ']'
++ cp tests/main/interfaces-content/task.yaml tests/main/interfaces-content/task.yaml.back
++ echo 'manual: true'
+++ echo -v
+++ tr , ' '
++ spread_params=-v
++ echo 'Running command: spread -v external:ubuntu-core-16-arm-32:tests/'
Running command: spread -v external:ubuntu-core-16-arm-32:tests/
++ spread -v external:ubuntu-core-16-arm-32:tests/
2018-08-21 04:57:46 Found /home/ubuntu/snapd/spread.yaml.
2018-08-21 04:57:49 Project content is packed for delivery (2.98MB).
2018-08-21 04:57:49 Sequence of jobs produced with -seed=1534827469
2018-08-21 04:57:49 If killed, discard servers with: spread -reuse-pid=707 -discard
2018-08-21 04:57:49 Allocating external:ubuntu-core-16-arm-32...
2018-08-21 04:57:49 Waiting for external:ubuntu-core-16-arm-32 to make SSH available at 10.101.50.181:22...
2018-08-21 04:57:49 Allocated external:ubuntu-core-16-arm-32.
2018-08-21 04:57:49 Connecting to external:ubuntu-core-16-arm-32...
2018-08-21 04:57:50 Connected to external:ubuntu-core-16-arm-32 at 10.101.50.181:22.
2018-08-21 04:57:50 Sending project content to external:ubuntu-core-16-arm-32...
2018-08-21 04:57:51 Preparing external:ubuntu-core-16-arm-32...
2018-08-21 04:57:52 Preparing external:ubuntu-core-16-arm-32:tests/main/...
2018-08-21 04:59:04 Preparing external:ubuntu-core-16-arm-32:tests/main/lxd...
2018-08-21 04:59:22 Executing external:ubuntu-core-16-arm-32:tests/main/lxd (1/204)...
2018-08-21 04:59:22 Restoring external:ubuntu-core-16-arm-32:tests/main/lxd...
2018-08-21 04:59:22 Preparing external:ubuntu-core-16-arm-32:tests/main/degraded...
2018-08-21 04:59:38 Executing external:ubuntu-core-16-arm-32:tests/main/degraded (2/204)...
2018-08-21 04:59:38 Restoring external:ubuntu-core-16-arm-32:tests/main/degraded...
2018-08-21 04:59:38 Preparing external:ubuntu-core-16-arm-32:tests/main/interfaces-broadcom-asic-control...
2018-08-21 05:00:04 Executing external:ubuntu-core-16-arm-32:tests/main/interfaces-broadcom-asic-control (3/204)...
2018-08-21 05:00:11 Restoring external:ubuntu-core-16-arm-32:tests/main/interfaces-broadcom-asic-control...
2018-08-21 05:00:11 Preparing external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade...
2018-08-21 05:00:44 Executing external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade (4/204)...
2018-08-21 05:01:02 Rebooting on external:ubuntu-core-16-arm-32 (external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade) as requested...
2018-08-21 05:01:45 Rebooting on external:ubuntu-core-16-arm-32 (external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade) as requested...
2018-08-21 05:02:45 Rebooting on external:ubuntu-core-16-arm-32 (external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade) as requested...
2018-08-21 05:03:26 Rebooting on external:ubuntu-core-16-arm-32 (external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade) as requested...

2018-08-21 05:03:29 Error executing external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade : 
-----
mesg: ttyname failed: Inappropriate ioctl for device
+ . /home/gopath/src/github.com/snapcore/snapd/tests/lib/boot.sh
++ GRUB_EDITENV=grub-editenv
++ case "$SPREAD_SYSTEM" in
+ '[' 0 '!=' 0 ']'
+ snap list
+ awk '/^core / {print($3)}'
+ '[' -f curChg ']'
+ case $SPREAD_REBOOT in
++ cat prevBoot
+ cmd='snap install --dangerous /var/lib/snapd/snaps/core_5336.snap'
++ eval snap install --dangerous /var/lib/snapd/snaps/core_5336.snap --no-wait
+++ snap install --dangerous /var/lib/snapd/snaps/core_5336.snap --no-wait
+ chg_id=13
+ echo 13
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ grep -q 'Waiting for system reboot'
+ journalctl -b -u snapd
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ echo 'Ensure the test snap still runs'
Ensure the test snap still runs
+ test-snapd-tools.echo hello
+ MATCH hello
+ echo 'Ensure the bootloader is correct before reboot'
Ensure the bootloader is correct before reboot
+ readlink /snap/core/current
++ cat prevBoot
++ cat nextBoot
+ test 5336 '!=' x1
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_try_core=//'
++ fw_printenv snap_try_core
++ cat nextBoot
+ test core_x1.snap = core_x1.snap
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
+ test try = try
+ echo 'Ensure the device is scheduled for auto-reboot'
Ensure the device is scheduled for auto-reboot
++ dbus-send --print-reply --type=method_call --system --dest=org.freedesktop.login1 /org/freedesktop/login1 org.freedesktop.DBus.Properties.Get string:org.freedesktop.login1.Manager string:ScheduledShutdown
+ output='method return time=1534827739.727348 sender=:1.2 -> destination=:1.16 serial=182 reply_serial=2
   variant       struct {
         string "reboot"
         uint64 1534828338444677
      }'
+ echo method return time=1534827739.727348 sender=:1.2 '->' destination=:1.16 serial=182 reply_serial=2 variant struct '{' string '"reboot"' uint64 1534828338444677 '}'
+ MATCH 'string "reboot"'
+ REBOOT
<REBOOT>

mesg: ttyname failed: Inappropriate ioctl for device
+ . /home/gopath/src/github.com/snapcore/snapd/tests/lib/boot.sh
++ GRUB_EDITENV=grub-editenv
++ case "$SPREAD_SYSTEM" in
+ '[' 1 '!=' 0 ']'
+ echo 'Waiting for snapd to clean snap_mode'
Waiting for snapd to clean snap_mode
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
## Error: "snap_mode" not defined
+ '[' '' '!=' '' ']'
+ echo 'Ensure the bootloader is correct after reboot'
Ensure the bootloader is correct after reboot
++ bootenv snap_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_core
++ sed 's/^snap_core=//'
++ cat nextBoot
+ test core_x1.snap = core_x1.snap
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_try_core=//'
++ fw_printenv snap_try_core
## Error: "snap_try_core" not defined
+ test '' = ''
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
## Error: "snap_mode" not defined
+ test '' = ''
+ snap list
+ awk '/^core / {print($3)}'
+ '[' -f curChg ']'
++ cat curChg
+ snap watch 13
+ rm -f curChg
+ case $SPREAD_REBOOT in
+ cmd='snap revert core'
++ eval snap revert core --no-wait
+++ snap revert core --no-wait
+ chg_id=14
+ echo 14
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ echo 'Ensure the test snap still runs'
Ensure the test snap still runs
+ test-snapd-tools.echo hello
+ MATCH hello
+ echo 'Ensure the bootloader is correct before reboot'
Ensure the bootloader is correct before reboot
+ readlink /snap/core/current
++ cat prevBoot
++ cat nextBoot
+ test x1 '!=' 5336
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_try_core=//'
++ fw_printenv snap_try_core
++ cat nextBoot
+ test core_5336.snap = core_5336.snap
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
+ test try = try
+ echo 'Ensure the device is scheduled for auto-reboot'
Ensure the device is scheduled for auto-reboot
++ dbus-send --print-reply --type=method_call --system --dest=org.freedesktop.login1 /org/freedesktop/login1 org.freedesktop.DBus.Properties.Get string:org.freedesktop.login1.Manager string:ScheduledShutdown
+ output='method return time=1534827783.613643 sender=:1.1 -> destination=:1.6 serial=35 reply_serial=2
   variant       struct {
         string "reboot"
         uint64 1534828348236218
      }'
+ echo method return time=1534827783.613643 sender=:1.1 '->' destination=:1.6 serial=35 reply_serial=2 variant struct '{' string '"reboot"' uint64 1534828348236218 '}'
+ MATCH 'string "reboot"'
+ REBOOT
<REBOOT>

mesg: ttyname failed: Inappropriate ioctl for device
+ . /home/gopath/src/github.com/snapcore/snapd/tests/lib/boot.sh
++ GRUB_EDITENV=grub-editenv
++ case "$SPREAD_SYSTEM" in
+ '[' 2 '!=' 0 ']'
+ echo 'Waiting for snapd to clean snap_mode'
Waiting for snapd to clean snap_mode
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
## Error: "snap_mode" not defined
+ '[' '' '!=' '' ']'
+ echo 'Ensure the bootloader is correct after reboot'
Ensure the bootloader is correct after reboot
++ bootenv snap_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_core
++ sed 's/^snap_core=//'
++ cat nextBoot
+ test core_5336.snap = core_5336.snap
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_try_core
++ sed 's/^snap_try_core=//'
## Error: "snap_try_core" not defined
+ test '' = ''
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_mode
++ sed 's/^snap_mode=//'
## Error: "snap_mode" not defined
+ test '' = ''
+ snap list
+ awk '/^core / {print($3)}'
+ '[' -f curChg ']'
++ cat curChg
+ snap watch 14
+ rm -f curChg
+ case $SPREAD_REBOOT in
++ cat prevBoot
+ cmd='snap install --dangerous /var/lib/snapd/snaps/core_5336.snap'
++ eval snap install --dangerous /var/lib/snapd/snaps/core_5336.snap --no-wait
+++ snap install --dangerous /var/lib/snapd/snaps/core_5336.snap --no-wait
+ chg_id=15
+ echo 15
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ echo 'Ensure the test snap still runs'
Ensure the test snap still runs
+ test-snapd-tools.echo hello
+ MATCH hello
+ echo 'Ensure the bootloader is correct before reboot'
Ensure the bootloader is correct before reboot
+ readlink /snap/core/current
++ cat prevBoot
++ cat nextBoot
+ test 5336 '!=' x2
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_try_core=//'
++ fw_printenv snap_try_core
++ cat nextBoot
+ test core_x2.snap = core_x2.snap
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
+ test try = try
+ echo 'Ensure the device is scheduled for auto-reboot'
Ensure the device is scheduled for auto-reboot
++ dbus-send --print-reply --type=method_call --system --dest=org.freedesktop.login1 /org/freedesktop/login1 org.freedesktop.DBus.Properties.Get string:org.freedesktop.login1.Manager string:ScheduledShutdown
+ output='method return time=1534827843.679753 sender=:1.2 -> destination=:1.42 serial=251 reply_serial=2
   variant       struct {
         string "reboot"
         uint64 1534828442536024
      }'
+ echo method return time=1534827843.679753 sender=:1.2 '->' destination=:1.42 serial=251 reply_serial=2 variant struct '{' string '"reboot"' uint64 1534828442536024 '}'
+ MATCH 'string "reboot"'
+ REBOOT
<REBOOT>

mesg: ttyname failed: Inappropriate ioctl for device
+ . /home/gopath/src/github.com/snapcore/snapd/tests/lib/boot.sh
++ GRUB_EDITENV=grub-editenv
++ case "$SPREAD_SYSTEM" in
+ '[' 3 '!=' 0 ']'
+ echo 'Waiting for snapd to clean snap_mode'
Waiting for snapd to clean snap_mode
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
## Error: "snap_mode" not defined
+ '[' '' '!=' '' ']'
+ echo 'Ensure the bootloader is correct after reboot'
Ensure the bootloader is correct after reboot
++ bootenv snap_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_core
++ sed 's/^snap_core=//'
++ cat nextBoot
+ test core_x2.snap = core_x2.snap
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_try_core=//'
++ fw_printenv snap_try_core
## Error: "snap_try_core" not defined
+ test '' = ''
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_mode
++ sed 's/^snap_mode=//'
## Error: "snap_mode" not defined
+ test '' = ''
+ snap list
+ awk '/^core / {print($3)}'
+ '[' -f curChg ']'
++ cat curChg
+ snap watch 15
+ rm -f curChg
+ case $SPREAD_REBOOT in
+ cmd='snap revert core'
++ eval snap revert core --no-wait
+++ snap revert core --no-wait
+ chg_id=16
+ echo 16
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ sleep 1
+ journalctl -b -u snapd
+ grep -q 'Waiting for system reboot'
+ echo 'Ensure the test snap still runs'
Ensure the test snap still runs
+ test-snapd-tools.echo hello
+ MATCH hello
+ echo 'Ensure the bootloader is correct before reboot'
Ensure the bootloader is correct before reboot
+ readlink /snap/core/current
++ cat prevBoot
++ cat nextBoot
+ test x2 '!=' 5336
++ bootenv snap_try_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_try_core
++ sed 's/^snap_try_core=//'
++ cat nextBoot
+ test core_5336.snap = core_5336.snap
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_mode
++ sed 's/^snap_mode=//'
+ test try = try
+ echo 'Ensure the device is scheduled for auto-reboot'
Ensure the device is scheduled for auto-reboot
++ dbus-send --print-reply --type=method_call --system --dest=org.freedesktop.login1 /org/freedesktop/login1 org.freedesktop.DBus.Properties.Get string:org.freedesktop.login1.Manager string:ScheduledShutdown
+ output='method return time=1534827852.166952 sender=:1.2 -> destination=:1.6 serial=35 reply_serial=2
   variant       struct {
         string "reboot"
         uint64 1534828450956996
      }'
+ echo method return time=1534827852.166952 sender=:1.2 '->' destination=:1.6 serial=35 reply_serial=2 variant struct '{' string '"reboot"' uint64 1534828450956996 '}'
+ MATCH 'string "reboot"'
+ REBOOT
<REBOOT>

+ . /home/gopath/src/github.com/snapcore/snapd/tests/lib/boot.sh
++ GRUB_EDITENV=grub-editenv
++ case "$SPREAD_SYSTEM" in
+ '[' 4 '!=' 0 ']'
+ echo 'Waiting for snapd to clean snap_mode'
Waiting for snapd to clean snap_mode
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ sed 's/^snap_mode=//'
++ fw_printenv snap_mode
+ '[' try '!=' '' ']'
+ sleep 1
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ sed 's/^snap_mode=//'
++ command -v grub-editenv
++ fw_printenv snap_mode
+ '[' try '!=' '' ']'
+ sleep 1
++ bootenv snap_mode
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_mode
++ sed 's/^snap_mode=//'
Cannot access MTD device /boot/uboot/uboot.env: No such file or directory
+ '[' '' '!=' '' ']'
+ echo 'Ensure the bootloader is correct after reboot'
Ensure the bootloader is correct after reboot
++ bootenv snap_core
++ '[' 1 -eq 0 ']'
++ command -v grub-editenv
++ fw_printenv snap_core
++ sed 's/^snap_core=//'
Cannot access MTD device /boot/uboot/uboot.env: No such file or directory
++ cat nextBoot
+ test '' = core_5336.snap
-----
.
2018-08-21 05:03:29 Error debugging external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade : sudo: unknown uid 1001: who are you?
2018-08-21 05:03:29 Restoring external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade...
2018-08-21 05:03:29 Error restoring external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade : sudo: unknown uid 1001: who are you?
2018-08-21 05:03:29 Restoring external:ubuntu-core-16-arm-32:tests/main/...
2018-08-21 05:03:29 Error restoring external:ubuntu-core-16-arm-32:tests/main/ : sudo: unknown uid 1001: who are you?
2018-08-21 05:03:29 Restoring external:ubuntu-core-16-arm-32...
2018-08-21 05:03:29 Error restoring external:ubuntu-core-16-arm-32 : sudo: unknown uid 1001: who are you?
2018-08-21 05:03:29 Discarding external:ubuntu-core-16-arm-32...
2018-08-21 05:03:29 Successful tasks: 3
2018-08-21 05:03:29 Aborted tasks: 200
2018-08-21 05:03:29 Failed tasks: 1
    - external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade
2018-08-21 05:03:29 Failed task restore: 1
    - external:ubuntu-core-16-arm-32:tests/main/ubuntu-core-upgrade
2018-08-21 05:03:29 Failed suite restore: 1
    - external:ubuntu-core-16-arm-32:tests/main/
2018-08-21 05:03:29 Failed project restore: 1
    - external:ubuntu-core-16-arm-32:project
error: unsuccessful run
2018-08-21 05:03:29,800 cm3-001 WARNING: Tests failed, rc=1
2018-08-21 05:03:29,801 cm3-001 INFO: END testrun
complete
